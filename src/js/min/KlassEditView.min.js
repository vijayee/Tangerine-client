var KlassEditView,bind=function(t,e){return function(){return t.apply(e,arguments)}},extend=function(t,e){function s(){this.constructor=t}for(var n in e)hasProp.call(e,n)&&(t[n]=e[n]);return s.prototype=e.prototype,t.prototype=new s,t.__super__=e.prototype,t},hasProp={}.hasOwnProperty;KlassEditView=function(e){function s(){return this.renderStudents=bind(this.renderStudents,this),this.onSubviewRendered=bind(this.onSubviewRendered,this),this.registerStudent=bind(this.registerStudent,this),s.__super__.constructor.apply(this,arguments)}return extend(s,e),s.prototype.className="KlassEditView",s.prototype.events={"click .back":"back","click .save":"basicInfoSave","click .basic_info_edit":"basicInfoToggle","click .basic_info_cancel":"basicInfoToggle","change #teacher_select":"teacherSelect","click .add_student":"addStudentToggle","click .add_student_cancel":"addStudentToggle","click .add_student_add":"addStudent","click .register_student":"registerStudentToggle","click .register_student_cancel":"registerStudentToggle","click .register_student_save":"registerStudent"},s.prototype.teacherSelect=function(){var t;return t=this.$el.find("#teacher_select option:selected").attr("data-teacherId"),this.klass.set("teacherId",t)},s.prototype.addStudentToggle=function(){return this.$el.find(".register_student_form input").val(""),this.$el.find(".add_student_form, .add_student").toggle()},s.prototype.registerStudentToggle=function(){return this.$el.find(".register_student_form, .register_student").toggle(),this.$el.find(".register_student_form").is(":visible")&&this.$el.find(".register_student_form").scrollTo(),this.$el.find("#register_student_name ,#register_student_gender, #register_student_age").val("")},s.prototype.addStudent=function(){var t,e;return"_none"===this.$el.find("#add_student_select option:selected").val()?alert("Please select a student, or cancel."):(e=this.$el.find("#add_student_select option:selected").attr("data-id"),t=this.allStudents.get(e),t.save({klassId:this.klass.id},{success:function(e){return function(){return e.students.add(t),e.addStudentToggle()}}(this)}))},s.prototype.registerStudent=function(){var t;return t=new Student,t.save({name:this.$el.find("#register_student_name").val(),gender:this.$el.find("#register_student_gender").val(),age:this.$el.find("#register_student_age").val(),klassId:this.klass.id},{success:function(e){return function(){return e.students.add(t),e.registerStudentToggle()}}(this)})},s.prototype.basicInfoToggle=function(){var t;return this.$el.find(".basic_info").toggle(),t=$(this.$el.find(".basic_info")[1]),t.is(":visible")&&(t.scrollTo(),this.$el.find("#year").focus()),this.$el.find("#school_name").val(this.klass.getString("schoolName")),this.$el.find("#year").val(this.klass.getString("year")),this.$el.find("#grade").val(this.klass.getString("grade")),this.$el.find("#stream").val(this.klass.getString("stream"))},s.prototype.basicInfoSave=function(){var t,e;return t=this.$el.find("#start_date").val().split("/"),e=new Date,e.setFullYear(parseInt(t[0])),e.setMonth(parseInt(t[1])-1),e.setDate(parseInt(t[2])),this.klass.save({schoolName:this.$el.find("#school_name").val(),year:this.$el.find("#year").val(),grade:this.$el.find("#grade").val(),stream:this.$el.find("#stream").val(),startDate:e.getTime()},{success:function(t){return function(){return t.render()}}(this),error:function(){return function(){return Utils.midAlert("Save error<br>Please try again.")}}(this)})},s.prototype.back=function(){return window.history.back()},s.prototype.initialize=function(t){return this.klass=t.klass,this.students=t.students,this.allStudents=t.allStudents,this.teachers=t.teachers,this.students.on("add remove change",this.renderStudents),this.views=[]},s.prototype.closeViews=function(){var t,e,s,n;for(s=this.views,t=0,e=s.length;e>t;t++)n=s[t],n.close();return this.views=[]},s.prototype.onSubviewRendered=function(){return this.trigger("subRendered")},s.prototype.renderStudents=function(){var t,e,s,n,a,i;for(t=$("<ul>").addClass("student_list"),this.closeViews(),n=this.students.models,e=0,s=n.length;s>e;e++)a=n[e],i=new StudentListElementView({student:a,students:this.students}),this.views.push(i),i.on("rendered",this.onSubviewRendered),i.render(),i.on("change",this.renderStudents),t.append(i.el);return this.$el.find("#student_list_wrapper").html(t)},s.prototype.render=function(){var e,s,n,a,i,r,d,l,o;return a=this.klass.getString("schoolName"),o=this.klass.getString("year"),e=this.klass.getString("grade"),r=this.klass.getString("stream"),i=new Date(this.klass.getNumber("startDate")),l="admin"===this.klass.get("teacherId")?"admin":this.teachers.get(this.klass.get("teacherId"))&&this.teachers.get(this.klass.get("teacherId")).has("name")?this.teachers.get(this.klass.get("teacherId")).get("name"):"unknown",Tangerine.user.isAdmin()&&(s="<tr><td><label>Teacher</label></td><td>"+l+"</td></tr>"),Tangerine.user.isAdmin()&&(n="<label>Teacher</label><br> <select id='teacher_select'> "+function(){var t,e,s,n;for(s=this.teachers.models,n=[],t=0,e=s.length;e>t;t++)d=s[t],n.push("<option "+(d.id===this.klass.get("teacherId")?"selected='selected' ":"")+" data-teacherId='"+d.id+"'>"+d.get("name")+"</option>");return n}.call(this)+" </select>"),this.$el.html("<button class='back navigation'>"+t("back")+"</button> <h1>"+t("class editor")+"</h1> <h2>"+t("basic info")+"</h2> <table class='info_box basic_info'> <tr><td><label>School name</label></td><td>"+a+"</td></tr> "+(s||"")+" <tr><td><label>School year</label></td><td>"+o+"</td></tr> <tr><td><label>"+t("grade")+"</label></td><td>"+e+"</td></tr> <tr><td><label>"+t("stream")+"</label></td><td>"+r+"</td></tr> <tr><td><label>"+t("starting date")+"</label></td><td>"+(i.getFullYear()+"/"+(i.getMonth()+1)+"/"+i.getDate())+"</td></tr> <tr><td colspan='2'><button class='basic_info_edit command'>"+t("edit")+"</button></td></tr> </table> <div class='basic_info confirmation'> <div class='menu_box'> <div class='label_value'> <label for='school_name'>School name</label> <input id='school_name' value='"+a+"'> </div> <div class='label_value'> "+(n||"")+" </div> <div class='label_value'> <label for='year'>School year</label> <input id='year' value='"+o+"'> </div> <div class='label_value'> <label for='grade'>"+t("grade")+"</label> <input id='grade' value='"+e+"'> </div> <div class='label_value'> <label for='stream'>"+t("stream")+"</label> <input id='stream' value='"+r+"'> </div> <div class='label_value'> <label for='start_date'>"+t("starting date")+"</label> <input id='start_date' value='"+(i.getFullYear()+"/"+(i.getMonth()+1)+"/"+i.getDate())+"'> </div> <button class='save command'>"+t("save")+"</button> <button class='basic_info_cancel command'>"+t("cancel")+"</button> </div> </div> <h2>"+t("students").capitalize()+"</h2> <div id='student_list_wrapper'></div> <!-- add student feature --> <!--button class='add_student command'>Add student</button> <div class='add_student_form menu_box confirmation'> <div class='label_value'> <label for='add_student_select'>"+t("add student")+"</label><br> <select id='add_student_select'> </select> </div> <button class='add_student_add command'>"+t("add")+"</button><button class='add_student_cancel command'>"+t("cancel")+"</button> </div--> <button class='register_student command'>"+$.t("register student")+"</button> <div class='register_student_form menu_box confirmation'> <h2>"+t("register student")+"</h2> <div class='label_value'> <label for='register_student_name'>Full name</label> <input id='register_student_name' value=''> </div> <div class='label_value'> <label for='register_student_gender'>"+t("gender")+"</label> <input id='register_student_gender' value=''> </div> <div class='label_value'> <label for='register_student_age'>"+t("age")+"</label> <input id='register_student_age' value=''> </div> <button class='register_student_save command'>"+t("save")+"</button> <button class='register_student_cancel command'>"+t("cancel")+"</button> </div>"),this.trigger("rendered"),this.renderStudents()},s}(Backbone.View);