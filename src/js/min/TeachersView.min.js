var TeachersView,extend=function(t,e){function a(){this.constructor=t}for(var r in e)hasProp.call(e,r)&&(t[r]=e[r]);return a.prototype=e.prototype,t.prototype=new a,t.__super__=e.prototype,t},hasProp={}.hasOwnProperty;TeachersView=function(e){function a(){return a.__super__.constructor.apply(this,arguments)}return extend(a,e),a.prototype.className="TeachersView",a.prototype.events={"click .edit_in_place":"editInPlace","focusout .editing":"editing","keyup    .editing":"editing","keydown  .editing":"editing","click    .change_password":"changePassword","change   .show_password":"showPassword","click    .save_password":"savePassword","click    .back":"goBack"},a.prototype.goBack=function(){return window.history.back()},a.prototype.initialize=function(t){return this.teachers=t.teachers,this.users=t.users,this.usersByTeacherId=this.users.indexBy("teacherId"),this.teacherProperties=[{key:"name",editable:!0,headerless:!0},{key:"first",label:"First",editable:!0,escaped:!0},{key:"last",label:"Last",editable:!0,escaped:!0},{key:"gender",label:"Gender",editable:!0},{key:"school",label:"School name",editable:!0},{key:"contact",label:"Contact Information",editable:!0}]},a.prototype.showPassword=function(t){var e,a;return e=$(t.target),a=e.attr("data-teacherId"),"password"===this.$el.find("."+a+"_password").attr("type")?this.$el.find("."+a+"_password").attr("type","text"):this.$el.find("."+a+"_password").attr("type","password")},a.prototype.changePassword=function(t){var e,a;return e=$(t.target),a=e.attr("data-teacherId"),this.$el.find("."+a+"_menu").toggleClass("confirmation"),this.$el.find("."+a).scrollTo(),this.$el.find("."+a+"_password").focus()},a.prototype.savePassword=function(t){var e,a,r,s;return e=$(t.target),a=e.attr("data-teacherId"),r=this.teachers.get(a),s=this.usersByTeacherId[a][0],s.setPassword(this.$el.find("."+a+"_password").val()),s.save(null,{success:function(t){return function(){return Utils.midAlert("Teacher's password saved"),t.$el.find("."+a+"_password").val(""),t.$el.find("."+a+"_menu").toggleClass("confirmation")}}(this),error:function(){return function(){return Utils.midAlert("Save error")}}(this)})},a.prototype.render=function(){var e,a,r,s;return s=this.getTeacherTable(),a="server"===Tangerine.settings.get("context")?"<button class='command_red delete'>Delete</button>":"","server"!==Tangerine.settings.get("context")&&(e="<button class='navigation back'>"+t("back")+"</button>"),r=(e||"")+" <h1>Teachers</h1> <div id='teacher_table_container'> "+s+" </div>",this.$el.html(r),this.trigger("rendered")},a.prototype.updateTable=function(){return this.$el.find("#teacher_table_container").html(this.getTeacherTable())},a.prototype.getTeacherTable=function(){var t,e,a,r,s,i,n,o,d;for(t="",n=this.teachers.models,e=0,r=n.length;r>e;e++){for(d=n[e],t+="<table class='class_table teachers "+d.id+"' > <tbody>",o=this.teacherProperties,a=0,s=o.length;s>a;a++)i=o[a],t+=this.propCookRow(i,d);t+="<tr class='last'><th><button class='change_password command' data-teacherId='"+d.id+"'>Change Password</button><br> <div class='"+d.id+"_menu confirmation'> <div class='menu_box'> <input type='password' class='"+d.id+"_password'> <table><tr> <th style='padding:0;'><label for='"+d.id+"_show_password'>Show password</label></th> <th style='padding:10px'><input type='checkbox' id='"+d.id+"_show_password' class='show_password' data-teacherId='"+d.id+"'></th> </tr></table> <button class='save_password command' data-teacherId='"+d.id+"'>Save</button> </div> </div> </th> </tr> </tbody> </table>"}return t},a.prototype.propCookRow=function(t,e){var a;return t.headerless?t.tagName="th":a="<th>"+t.label+"</th>","<tr>"+(a||"")+this.propCook(t,e)+"</tr>"},a.prototype.propCook=function(t,e){var a,r,s,i;return i=null!=t.key?e.get(t.key):"&nbsp;",i=t.escape?e.escape(t.key):i,null==i&&(i="_"),s=t.tagName||"td",a=t.editable?"edit_in_place":"",r=_.isNumber(i)?"data-isNumber='true'":"data-isNumber='false'","<"+s+" class='"+a+"'><span data-teacherId='"+e.id+"' data-key='"+t.key+"' data-value='"+i+"' "+a+" "+r+">"+i+"</div></"+s+">"},a.prototype.editInPlace=function(t){var e,a,r,s,i,n,o,d,c,l,h,p,u;if(!this.alreadyEditing&&(this.alreadyEditing=!0,e=$(t.target),("TD"!==e.prop("tagName")||(e=e.find("span"),0!==e.length))&&(r=e.parent(),this.$oldSpan=e.clone(),"TEXTAREA"!==e.prop("tagName"))))return n=Utils.guid(),d=e.attr("data-key"),o="true"===e.attr("data-isNumber"),p=e.attr("data-teacherId"),h=this.teachers.get(p),l=o?h.getNumber(d):h.getString(d),a=$(t.target),i=(a.attr("class")||"").replace("settings",""),c=a.css("margin"),"items"===d&&(l=l.join(" ")),u="data-isNumber='"+o+"' data-key='"+d+"' data-teacherId='"+p+"' ",r.html("<textarea id='"+n+"' "+u+" class='editing "+i+"' style='margin:"+c+"'>"+l+"</textarea>"),s=$("#"+n),s.focus()},a.prototype.editing=function(t){var e,a,r,s,i,n,o,d,c;return e=$(t.target),a=e.parent(),27===t.which||"focusout"===t.type?(e.remove(),a.html(this.$oldSpan),void(this.alreadyEditing=!1)):13!==t.which||"keydown"!==t.type?!0:(this.alreadyEditing=!1,i=e.attr("data-key"),s="true"===e.attr("data-isNumber"),c=e.attr("data-teacherId"),d=this.teachers.get(c),o=d.get(i),n=e.val(),n=s?parseInt(n):n,"items"===i&&(n=n.replace(/\s+/g," "),/\t|,/.test(n)&&alert('Please remember\n\nGrid items are space " " delimited'),n=_.compact(n.split(" "))),String(n)!==String(o)&&(r={},r[i]=n,d.save(r,{success:function(t){return function(){return Utils.topAlert("Teacher saved"),d.fetch({success:function(){return t.updateTable()}})}}(this),error:function(t){return function(){return d.fetch({success:function(){return t.updateTable(),alert("Please try to save again, it didn't work that time.")}})}}(this)})),!1)},a}(Backbone.View);