Tangerine.bootSequence={basicConfig:function(e){return Tangerine.db=new PouchDB(Tangerine.conf.db_name),Backbone.sync=BackbonePouch.sync({db:Tangerine.db,fetch:"view",view:"tangerine/byCollection",viewOptions:{include_docs:!0}}),Backbone.Model.prototype.idAttribute="_id",_.templateSettings={interpolate:/\{\{(.+?)\}\}/g},e()},checkDatabase:function(e){var n;return n=Tangerine.db,n.get("initialized",function(t){return t?(console.log("initializing database"),n.put({_id:"_design/"+Tangerine.conf.design_doc,views:{byDKey:{map:function(e){var n;if("result"!==e.collection){if(e.curriculumId){if(n=e.curriculumId,"klass"===e.collection)return}else n=e.assessmentId;return emit(n.substr(-5,5),null)}}.toString()},byCollection:{map:function(e){var n;if(e.collection)return emit(e.collection,null),"subtest"===e.collection?emit("subtest-"+e.assessmentId):"question"===e.collection?emit("question-"+e.subtestId):"result"===e.collection?(n={_id:e._id},e.subtestData.forEach(function(e){return"id"===e.prototype&&(n.participantId=e.data.participant_id),"complete"===e.prototype?n.endTime=e.data.end_time:void 0}),n.startTime=e.start_time,emit("result-"+e.assessmentId,n)):void 0}.toString()}}}).then(function(){var t,i;return i=0,(t=function(){var r;return r=("0000"+i).slice(-4),$.ajax({dataType:"json",url:"js/init/pack"+r+".json",error:function(t){return 404===t.status?n.put({_id:"initialized"}).then(function(){return e()}):void 0},success:function(e){return i++,n.bulkDocs(e.docs,function(e){return e?alert("could not save initialization document: "+e):t()})}})})()})):e()})},versionTag:function(e){return $("#footer").append("<div id='version'>"+Tangerine.version+"-"+Tangerine.buildVersion+"</div>"),e()},fetchSettings:function(e){return Tangerine.settings=new Settings({_id:"settings"}),Tangerine.settings.fetch({success:e,error:function(){return Tangerine.settings.save(Tangerine.defaults.settings,{error:function(){return console.error(arguments),alert("Could not save default settings")},success:e})}})},guaranteeInstanceId:function(e){return Tangerine.settings.has("instanceId")?e():Tangerine.settings.save({instanceId:Utils.humanGUID()},{error:function(){return alert("Could not save new Instance Id")},success:e})},documentReady:function(e){return $(function(){return e()})},loadI18n:function(e){return $.i18n.init({fallbackLng:!1,lng:Tangerine.settings.get("language"),resGetPath:"locales/__lng__/translation.json"},function(n){return window.t=n,e()})},handleCordovaEvents:function(e){return document.addEventListener("deviceready",function(){return document.addEventListener("online",function(){return Tangerine.online=!0}),document.addEventListener("offline",function(){return Tangerine.online=!1}),document.addEventListener("backbutton",Tangerine.onBackButton,!1)},!1),e()},loadSingletons:function(e){return window.vm=new ViewManager,Tangerine.router=new Router,Tangerine.user=new TabletUser,Tangerine.nav=new NavigationView({user:Tangerine.user,router:Tangerine.router}),Tangerine.log=new Log,Tangerine.session=new Session,e()},reloadUserSession:function(e){return Tangerine.user.sessionRefresh({error:function(){return Tangerine.user.logout()},success:e})},startBackbone:function(e){return Backbone.history.start(),e()}},Tangerine.boot=function(){var e;return e=[Tangerine.bootSequence.basicConfig,Tangerine.bootSequence.checkDatabase,Tangerine.bootSequence.versionTag,Tangerine.bootSequence.fetchSettings,Tangerine.bootSequence.guaranteeInstanceId,Tangerine.bootSequence.documentReady,Tangerine.bootSequence.loadI18n,Tangerine.bootSequence.handleCordovaEvents,Tangerine.bootSequence.loadSingletons,Tangerine.bootSequence.reloadUserSession,Tangerine.bootSequence.startBackbone],Utils.execute(e)},Tangerine.boot();