var Log,LogView,Logs,extend=function(e,t){function n(){this.constructor=e}for(var r in t)hasProp.call(t,r)&&(e[r]=t[r]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},hasProp={}.hasOwnProperty,bind=function(e,t){return function(){return e.apply(t,arguments)}};Log=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return extend(t,e),t.prototype.url="log",t.prototype.app=function(e,t){return null==e&&(e=""),null==t&&(t=""),~Tangerine.settings.get("log").indexOf("app")?this.add({type:"app",code:e,details:t,timestamp:(new Date).getTime()}):void 0},t.prototype.db=function(e,t){return null==e&&(e=""),null==t&&(t=""),~Tangerine.settings.get("log").indexOf("db")?this.add({type:"db",code:e,details:t,timestamp:(new Date).getTime()}):void 0},t.prototype.ui=function(e,t){return null==e&&(e=""),null==t&&(t=""),~Tangerine.settings.get("log").indexOf("ui")?this.add({type:"ui",code:e,details:t,timestamp:(new Date).getTime()}):void 0},t.prototype.err=function(e,t){return null==e&&(e=""),null==t&&(t=""),!~Tangerine.settings.get("log").indexOf("err")},t.prototype.add=function(e){var t,n;return t=new Date,n="not-signed-in",null!=Tangerine.user.name()&&(n=Tangerine.user.name()),this.unset("_rev"),this.save({_id:this.calcName(),year:t.getFullYear(),month:t.getMonth(),date:t.getDate(),timestamp:t.getTime(),user:n,event:e})},t.prototype.calcName=function(){var e,t;return e=new Date,t="not-signed-in",null!=Tangerine.user.name()&&(t=Tangerine.user.name()),hex_sha1(t+"_"+e.getTime())},t}(Backbone.Model),Logs=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return extend(t,e),t.prototype.url="log",t.prototype.model=Log,t.prototype.pouch={viewOptions:{key:"log"}},t.prototype.comparator=function(e){return e.get("timestamp")},t}(Backbone.Collection),LogView=function(e){function t(){return this.render=bind(this.render,this),t.__super__.constructor.apply(this,arguments)}return extend(t,e),t.prototype.className="LogView",t.prototype.events={"change #user_selector":"update"},t.prototype.initialize=function(e){return this.logs=e.logs,this.logsByUser=this.logs.indexBy("user"),this.selectedUser=_.first(_.keys(this.logsByUser))},t.prototype.render=function(){var e,t;return e=function(){var e,n,r,o;for(r=_.keys(this.logsByUser),o=[],e=0,n=r.length;n>e;e++)t=r[e],o.push("<option data-user='"+t+"' "+((this.selectedUser===t?"selected='selected'":void 0)||"")+">"+t+"</option>");return o}.call(this).join(""),this.$el.html("<h1>Logs</h1> <select id='user_selector'>"+e+"</select> <div class='log_container'></div>"),this.update(),this.trigger("rendered")},t.prototype.update=function(){var e,t,n,r,o,i,s,a,u,l;for(this.selectedUser=this.$el.find("#user_selector option:selected").attr("data-user"),a=this.logsByUser[this.selectedUser],r="<h2>User "+this.selectedUser+"</h2> <table> <tr> <th>Code</th> <th>Details</th> <th>Time</th> </tr>",o=0,i=a.length;i>o;o++){if(s=a[o],null==s.get("event"))return;n=s.get("event"),u=s.get("user"),e=n.code,t=n.details,l=new Date(parseInt(n.timestamp)).toString(),r+="<tr> <td>"+e+"</td> <td>"+t+"</td> <td>"+l+"</td> </tr>"}return r+="</table>",this.$el.find(".log_container").html(r)},t}(Backbone.View);