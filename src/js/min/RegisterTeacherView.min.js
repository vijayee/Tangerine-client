var RegisterTeacherView,extend=function(e,t){function s(){this.constructor=e}for(var r in t)hasProp.call(t,r)&&(e[r]=t[r]);return s.prototype=t.prototype,e.prototype=new s,e.__super__=t.prototype,e},hasProp={}.hasOwnProperty;RegisterTeacherView=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return extend(t,e),t.prototype.className="RegisterTeacherView",t.prototype.events={"click .register":"register","click .cancel":"cancel"},t.prototype.initialize=function(e){return this.name=e.name,this.pass=e.pass,this.fields=["first","last","gender","school","contact"]},t.prototype.cancel=function(){return Tangerine.router.login()},t.prototype.register=function(){return this.validate(function(e){return function(){return e.saveUser()}}(this))},t.prototype.validate=function(e){var t,s,r,i,a;for(s=!1,a=this.fields,r=0,i=a.length;i>r;r++)t=a[r],_.isEmpty(this[t].val())?(this.$el.find("#"+t+"_message").html("Please fill out this field."),s=!0):this.$el.find("#"+t+"_message").html("");return s?Utils.midAlert("Please correct the errors on this page."):e()},t.prototype.saveUser=function(){var e,t,s,r,i,a,n;for(n={name:this.name},i=this.fields,s=0,r=i.length;r>s;s++)t=i[s],n[t]=this[t].val();return e={name:this.name},a=new Teacher(n),a.save({_id:Utils.humanGUID()},{success:function(e){return function(){return Tangerine.user.save({teacherId:a.id},{success:function(){return Utils.midAlert("New teacher registered"),Tangerine.user.login(e.name,e.pass,{success:function(){return Tangerine.router.landing()}})},error:function(e){return Utils.midAlert("Registration error<br>"+e,5e3)}})}}(this)})},t.prototype.render=function(){var e,t,s,r,i;for(this.$el.html("<h1>Register new teacher</h1> <table> <tr> <td class='small_grey'><b>Username</b></td> <td class='small_grey'>"+this.name+"</td> <td class='small_grey'><b>Password</b></td> <td class='small_grey'>"+function(){var e,t,s,r;for(s=this.pass,r=[],e=0,t=s.length;t>e;e++)i=s[e],r.push("*");return r}.call(this).join("")+"</td> </tr> </table> <div class='label_value'> <label for='first'>First name</label> <div id='first_message' class='messages'></div> <input id='first'> </div> <div class='label_value'> <label for='last'>Last Name</label> <div id='last_message' class='messages'></div> <input id='last'> </div> <div class='label_value'> <label for='gender'>Gender</label> <div id='gender_message' class='messages'></div> <input id='gender'> </div> <div class='label_value'> <label for='school'>School name</label> <div id='school_message' class='messages'></div> <input id='school'> </div> <div class='label_value'> <label for='contact'>Email address or mobile phone number</label> <div type='email' id='contact_message' class='messages'></div> <input id='contact'> </div> <button class='register command'>Register</button> <button class='cancel command'>Cancel</button>"),r=this.fields,t=0,s=r.length;s>t;t++)e=r[t],this[e]=this.$el.find("#"+e);return this.trigger("rendered")},t}(Backbone.View);