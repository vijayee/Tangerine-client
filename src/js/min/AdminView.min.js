var AdminView,bind=function(t,e){return function(){return t.apply(e,arguments)}},extend=function(t,e){function n(){this.constructor=t}for(var r in e)hasProp.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},hasProp={}.hasOwnProperty;AdminView=function(t){function e(){return this.render=bind(this.render,this),e.__super__.constructor.apply(this,arguments)}return extend(e,t),e.prototype.className="AdminView",e.prototype.events={"click .update ":"update"},e.prototype.update=function(t){var e,n;return e=$(t.target),n=e.attr("data-group"),Utils.updateTangerine(null,{targetDB:n})},e.prototype.getVersionNumber=function(t){return $.ajax("/"+t+"/_design/"+Tangerine.design_doc+"/js/version.js",{dataType:"text",success:function(e){return function(n){return console.log(n),e.$el.find("#"+t+"-version").html(n.match(/"(.*)"/)[1])}}(this)})},e.prototype.initialize=function(t){return this.groups=t.groups},e.prototype.render=function(){var t,e;return e=_.after(this.groups.length,function(){return $("table#active-groups").tablesorter({widgets:["zebra"],sortList:[[5,1]]})}),this.$el.html("<h2>Group Activity</h2> <table id='active-groups' class='class_table'> <thead> "+_(["Name","Last Complete Result","Total Assessments","Total Results","Version","Last Result"]).map(function(t){return"<th>"+t+"</th>"}).join("")+" </thead> <tbody> "+function(){var e,n,r,s;for(r=this.groups,s=[],e=0,n=r.length;n>e;e++)t=r[e],s.push("<tr id='"+t+"'> <td> "+t+"<br> </td> <td class='last-result'>...</td> <td class='total-assessments'>...</td> <td class='total-results'>...</td> <td class='version'><div>...</div><button class='update command' data-group='"+t+"'>Update</button></td> <td class='last-timestamp'>...</td> </tr>");return s}.call(this).join("")+" </tbody> </table>"),$("table#active-groups").tablesorter({widgets:["zebra"],sortList:[[5,1]]}),_(this.groups).each(function(t){return function(n){var r;return r=t.$el.find("#"+n),$.ajax("/"+n+"/_design/"+Tangerine.design_doc+"/js/version.js",{dataType:"text",success:function(t){return r.find(".version div").html(t.match(/"(.*)"/)[1]),$.couch.db(n).view(Tangerine.design_doc+"/resultCount",{group:!0,success:function(){return function(t){var s,o;for(r.find(".total-assessments").html(t.rows.length),s=0;o=t.rows.pop();)s+=parseInt(o.value);return r.find(".total-results").html("<button class='results navigation'><a href='/"+n+"/_design/"+Tangerine.design_doc+"/index.html#dashboard'>"+s+"</a></button>"),$.couch.db(n).view(Tangerine.design_doc+"/completedResultsByEndTime",{limit:1,descending:!0,success:function(t){return t.rows[0]&&t.rows[0].key?(r.find(".last-timestamp").html(moment(new Date(t.rows[0].key)).format("YYYY-MMM-DD HH:mm")),r.find(".last-result").html(moment(t.rows[0].key).fromNow())):void 0},error:function(){return console.log("Could not retrieve view 'completedResultsByEndTime' for "+n)}}).complete(function(){return e()})}}(this)})}})}}(this)),this.trigger("rendered")},e}(Backbone.View);