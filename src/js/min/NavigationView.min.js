var NavigationView,bind=function(t,i){return function(){return t.apply(i,arguments)}},extend=function(t,i){function n(){this.constructor=t}for(var e in i)hasProp.call(i,e)&&(t[e]=i[e]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t},hasProp={}.hasOwnProperty;NavigationView=function(i){function n(){return this.handleMenu=bind(this.handleMenu,this),this.initialize=bind(this.initialize,this),this.userMenuOut=bind(this.userMenuOut,this),this.userMenuIn=bind(this.userMenuIn,this),this.calcWhoAmI=bind(this.calcWhoAmI,this),n.__super__.constructor.apply(this,arguments)}return extend(n,i),n.prototype.el="#navigation",n.prototype.events=Modernizr.touch?{"click #logout":"logout","click #navigation-logo":"logoClick","click #username":"gotoAccount"}:{"click #logout":"logout","click #navigation-logo":"logoClick","click #username":"gotoAccount"},n.prototype.calcWhoAmI=function(){return this.whoAmI="User"},n.prototype.refreshDropDownPosition=function(){var t,i;return i=this.$el.find("#username-container").position(),t=this.$el.find("#username-dropdown"),t.css({left:Math.min(i.left,$(window).width()-t.width())})},n.prototype.userMenuIn=function(){return this.refreshDropDownPosition(),this.$el.find("#username-dropdown").show()},n.prototype.userMenuOut=function(){return this.refreshDropDownPosition(),this.$el.find("#username-dropdown").hide()},n.prototype.gotoAccount=function(){return this.user.isAdmin()?Tangerine.router.navigate("account",!0):void 0},n.prototype.logoClick=function(){return this.user.isAdmin()?(Tangerine.activity="",this.router.landing(!0)):"assessment run"!==Tangerine.activity?this.router.landing(!0):confirm(this.text.incomplete_main)?this.router.landing(!0):void 0},n.prototype.logout=function(){if(this.user.isAdmin())return Tangerine.activity="",Tangerine.user.logout();if("assessment run"===Tangerine.activity){if(confirm(this.text.incomplete_logout))return Tangerine.activity="",Tangerine.user.logout()}else if(confirm(this.text.confirm_logout))return Tangerine.activity="",Tangerine.user.logout()},n.prototype.onClose=function(){},n.prototype.initialize=function(t){return this.$el.addClass("NavigationView"),this.i18n(),this.render(),this.user=t.user,this.router=t.router,this.calcWhoAmI(),this.router.on("all",this.handleMenu),this.user.on("login logout",this.handleMenu)},n.prototype.i18n=function(){return this.text={logout:t("NavigationView.button.logout"),account_button:t("NavigationView.button.account"),settings_button:t("NavigationView.button.settings"),user:t("NavigationView.label.user"),teacher:t("NavigationView.label.teacher"),enumerator:t("NavigationView.label.enumerator"),student_id:t("NavigationView.label.student_id"),version:t("NavigationView.label.version"),account:t("NavigationView.help.account"),logo:t("NavigationView.help.logo"),incomplete_logout:t("NavigationView.message.incomplete_logout"),confirm_logout:t("NavigationView.message.logout_confirm"),incomplete_main:t("NavigationView.message.incomplete_main_screen")}},n.prototype.render=function(){var t;return this.$el.html("<img id='navigation-logo' src='images/navigation-logo.png' title='"+this.text.logo+"'> <ul> <li id='student-container' class='hidden'> <label>"+this.text.student_id+"</label> <div id='student-id'></div> </li> <li id='username-container'> <label title='"+this.text.account+"'>"+this.whoAmI+"</label> <div id='username'>"+(Tangerine.user.name()||"")+"</div> <ul id='username-dropdown'> <li><a href='#account'>"+this.text.account_button+"</a></li> <li><a href='#settings'>"+this.text.settings_button+"</a></li> </ul> </li> <li id='logout'>"+this.text.logout+"</li> </ul>"),(null!=(t=this.user)&&"function"==typeof t.isAdmin?t.isAdmin():void 0)&&this.$el.find("#username-container").hover(this.userMenuIn,this.userMenuOut),$(document).ajaxStart(function(){return"images/navigation-logo-spin.gif"!==$("#navigation-logo").attr("src")?$("#navigation-logo").attr("src","images/navigation-logo-spin.gif"):void 0}),$(document).ajaxStop(function(){return"images/navigation-logo.png"!==$("#navigation-logo").attr("src")?$("#navigation-logo").attr("src","images/navigation-logo.png"):void 0})},n.prototype.setStudent=function(t){return""===t?(this.$el.find("#student-container").addClass("hidden"),this.$el.find("#student-id").html("")):(this.$el.find("#student-container").removeClass("hidden"),this.$el.find("#student-id").html(t))},n.prototype.handleMenu=function(){return this.calcWhoAmI(),$("#username_label").html(this.whoAmI),$("#username").html(this.user.name()),~window.location.toString().indexOf("name=")?this.$el.find("#logout_link").hide():this.$el.find("#logout_link").show(),this.user.verify({isAuthenticated:function(t){return function(){return t.render(),$("#navigation").fadeIn(250)}}(this),isUnregistered:function(t){return function(){return t.render(),$("#navigation").fadeOut(250)}}(this)})},n}(Backbone.View);