var QuestionRunView,SurveyReviewView,bind=function(t,e){return function(){return t.apply(e,arguments)}},extend=function(t,e){function i(){this.constructor=t}for(var s in e)hasProp.call(e,s)&&(t[s]=e[s]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},hasProp={}.hasOwnProperty;QuestionRunView=function(t){function e(){return this.getName=bind(this.getName,this),this.setName=bind(this.setName,this),this.setHint=bind(this.setHint,this),this.setPrompt=bind(this.setPrompt,this),this.setMessage=bind(this.setMessage,this),this.setAnswer=bind(this.setAnswer,this),this.setOptions=bind(this.setOptions,this),this.updateResult=bind(this.updateResult,this),this.update=bind(this.update,this),this.onShow=bind(this.onShow,this),this.previousAnswer=bind(this.previousAnswer,this),e.__super__.constructor.apply(this,arguments)}return extend(e,t),e.prototype.className="question",e.prototype.events={"change input":"update","change textarea":"update","click .autoscroll_icon":"scroll"},e.prototype.scroll=function(t){return this.trigger("scroll",t,this.model.get("order"))},e.prototype.initialize=function(t){return this.on("show",function(t){return function(){return t.onShow()}}(this)),this.model=t.model,this.parent=t.parent,this.dataEntry=t.dataEntry,this.fontFamily=this.parent.model.get("fontFamily"),""!==this.parent.model.get("fontFamily")&&(this.fontStyle='style="font-family: '+this.parent.model.get("fontFamily")+' !important;"'),this.answer=this.dataEntry?{}:t.answer,this.name=this.model.escape("name").replace(/[^A-Za-z0-9_]/g,"-"),this.type=this.model.get("type"),this.options=this.model.get("options"),this.notAsked=t.notAsked,this.isObservation=t.isObservation,this.defineSpecialCaseResults(),this.model.getBoolean("skippable")?(this.isValid=!0,this.skipped=!0):(this.isValid=!1,this.skipped=!1),this.notAsked===!0&&(this.isValid=!0,this.updateResult()),"single"===this.type||"multiple"===this.type?(this.button=new ButtonView({options:this.options,mode:this.type,dataEntry:this.dataEntry,answer:this.answer,fontFamily:this.fontFamily}),this.button.on("change rendered",function(t){return function(){return t.update()}}(this))):void 0},e.prototype.previousAnswer=function(){return this.parent.questionIndex>=0?this.parent.questionViews[this.parent.questionIndex-1].answer:void 0},e.prototype.onShow=function(){var t,e,i,s,n;if(n=this.model.getString("displayCode"),!_.isEmptyString(n))try{return CoffeeScript.eval.apply(this,[n])}catch(e){return t=e,s=/function (.{1,})\(/.exec(t.constructor.toString())[1],i=t.message,alert("Display code error\n\n"+s+"\n\n"+i)}},e.prototype.update=function(t){return this.updateResult(),this.updateValidity(),this.trigger("answer",t,this.model.get("order"))},e.prototype.updateResult=function(){var t,e,i,s,n,r;if(this.notAsked===!0){if("multiple"===this.type){for(n=this.options,r=[],t=e=0,i=n.length;i>e;t=++e)s=n[t],r.push(this.answer[this.options[t].value]="not_asked");return r}return this.answer="not_asked"}return this.answer="open"===this.type?this.$el.find("#"+this.cid+"_"+this.name).val():this.button.answer},e.prototype.updateValidity=function(){var t,e,i,s,n,r;if(r=this.model.getBoolean("skippable"),s=this.$el.hasClass("disabled_autostop"),n=this.$el.hasClass("disabled_skipped"),r||n||s)return this.isValid=!0,this.skipped=_.isEmptyString(this.answer)?!0:!1;if(t=this.model.get("customValidationCode"),this.answer||(this.answer=""),_.isEmptyString(t))return this.isValid=function(){switch(this.type){case"open":return _.isEmptyString(this.answer)||_.isEmpty(this.answer)&&_.isObject(this.answer)?!1:!0;case"multiple":return~_.values(this.answer).indexOf("checked")?!0:!1;case"single":return _.isEmptyString(this.answer)||_.isEmpty(this.answer)&&_.isObject(this.answer)?!1:!0}}.call(this);try{return this.isValid=CoffeeScript.eval.apply(this,[t])}catch(i){return e=i,alert("Custom Validation error\n\n"+e)}},e.prototype.setOptions=function(t){return this.button.options=t,this.button.render()},e.prototype.setAnswer=function(t){return _.isString(t)&&"multiple"===this.type&&alert("setAnswer Error\nTried to set "+this.type+" type "+this.name+" question to string answer."),_.isObject(t)||"multiple"!==this.type||alert("setAnswer Error\n"+this.name+" question requires an object"),"multiple"===this.type?this.button.answer=$.extend(this.button.answer,t):"single"===this.type?this.button.answer=t:this.answer=t,this.updateValidity(),this.button.render()},e.prototype.setMessage=function(t){return this.$el.find(".error_message").html(t)},e.prototype.setPrompt=function(t){return this.$el.find(".prompt").html(t)},e.prototype.setHint=function(t){return this.$el.find(".hint").html(t)},e.prototype.setName=function(t){return null==t&&(t=this.model.get("name")),this.model.set("name",t),this.name=this.model.escape("name").replace(/[^A-Za-z0-9_]/g,"-")},e.prototype.getName=function(){return this.model.get("name")},e.prototype.render=function(){var t,e;return this.$el.attr("id","question-"+this.name),this.notAsked?(this.$el.hide(),this.trigger("rendered")):(e="<div class='error_message'></div><div class='prompt' "+(this.fontStyle||"")+">"+this.model.get("prompt")+"</div> <div class='hint' "+(this.fontStyle||"")+">"+(this.model.get("hint")||"")+"</div>","open"===this.type?(_.isString(this.answer)&&!_.isEmpty(this.answer)&&(t=this.answer),e+=this.model.get("multiline")?"<div><textarea id='"+this.cid+"_"+this.name+"' data-cid='"+this.cid+"' value='"+(t||"")+"'></textarea></div>":"<div><input id='"+this.cid+"_"+this.name+"' data-cid='"+this.cid+"' value='"+(t||"")+"'></div>"):e+="<div class='button_container'></div>",this.isObservation&&(e+="<img src='images/icon_scroll.png' class='icon autoscroll_icon' data-cid='"+this.cid+"'>"),this.$el.html(e),"single"===this.type||"multiple"===this.type?(this.button.setElement(this.$el.find(".button_container")),this.button.on("rendered",function(t){return function(){return t.trigger("rendered")}}(this)),this.button.render()):this.trigger("rendered"))},e.prototype.defineSpecialCaseResults=function(){var t,e,i,s,n,r,o,h,a;for(o=["missing","notAsked","skipped","logicSkipped","notAskedAutostop"],i=0,n=o.length;n>i;i++)if(t=o[i],("single"===this.type||"open"===this.type)&&(this[t+"Result"]=t),"multiple"===this.type)for(this[t+"Result"]={},a=this.options,e=s=0,r=a.length;r>s;e=++s)h=a[e],this[t+"Result"][this.options[e].value]=t},e}(Backbone.View),SurveyReviewView=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return extend(e,t),e.prototype.className="QuestionReviewView",e.prototype.initialize=function(t){return this.views=t.views},e.prototype.render=function(){var t,e;return t=function(){var t,i,s,n;for(s=this.views,n=[],t=0,i=s.length;i>t;t++)e=s[t],n.push("<div class='label_value'> <h3></h3> </div>");return n}.call(this).join(""),this.$el.html("<h2>Please review your answers and press next when ready.</h2> "+t)},e}(Backbone.View);