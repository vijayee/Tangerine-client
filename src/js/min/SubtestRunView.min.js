var SubtestRunView,bind=function(t,e){return function(){return t.apply(e,arguments)}},extend=function(t,e){function o(){this.constructor=t}for(var n in e)hasProp.call(e,n)&&(t[n]=e[n]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},hasProp={}.hasOwnProperty;SubtestRunView=function(e){function o(){return this.hideNext=bind(this.hideNext,this),this.showNext=bind(this.showNext,this),this.afterRender=bind(this.afterRender,this),this.flagRender=bind(this.flagRender,this),o.__super__.constructor.apply(this,arguments)}return extend(o,e),o.prototype.className="SubtestRunView",o.prototype.events={"click .subtest-next":"next","click .subtest-back":"back","click .subtest_help":"toggleHelp","click .skip":"skip"},o.prototype.toggleHelp=function(){return this.$el.find(".enumerator_help").fadeToggle(250)},o.prototype.i18n=function(){return this.text={next:t("SubtestRunView.button.next"),back:t("SubtestRunView.button.back"),skip:t("SubtestRunView.button.skip"),help:t("SubtestRunView.button.help")}},o.prototype.initialize=function(t){return this.i18n(),this.model=t.model,this.parent=t.parent,""!==this.model.get("fontFamily")&&(this.fontStyle='style="font-family: '+this.model.get("fontFamily")+' !important;"'),this.prototypeRendered=!1},o.prototype.render=function(){var t,e;return t=function(t){return function(){var e,o,n,r,i,s,p;return t.delegateEvents(),n=""!==(t.model.get("enumeratorHelp")||"")?"<button class='subtest_help command'>"+t.text.help+"</button><div class='enumerator_help' "+(t.fontStyle||"")+">"+t.model.get("enumeratorHelp")+"</div>":"",s=""!==(t.model.get("studentDialog")||"")?"<div class='student_dialog' "+(t.fontStyle||"")+">"+t.model.get("studentDialog")+"</div>":"",p=""!==(t.model.get("transitionComment")||"")?"<div class='student_dialog' "+(t.fontStyle||"")+">"+t.model.get("transitionComment")+"</div> <br>":"",i=t.model.get("skippable")===!0||"true"===t.model.get("skippable"),o=(t.model.get("backButton")===!0||"true"===t.model.get("backButton"))&&0!==t.parent.index,i&&(r="<button class='skip navigation'>"+t.text.skip+"</button>"),o&&(e="<button class='subtest-back navigation'>"+t.text.back+"</button>"),t.$el.html("<h2>"+t.model.get("name")+"</h2> "+n+" "+s+" <div id='prototype_wrapper'></div> <div class='controlls clearfix'> "+p+" "+(e||"")+" <button class='subtest-next navigation'>"+t.text.next+"</button> "+(r||"")+" </div>"),console.log(t.model),t.prototypeView=new(window[t.model.get("prototype").titleize()+"RunView"])({model:t.model,parent:t}),t.prototypeView.on("rendered",function(){return t.flagRender("prototype")}),t.prototypeView.on("subRendered",function(){return t.trigger("subRendered")}),t.prototypeView.on("showNext",function(){return t.showNext()}),t.prototypeView.on("hideNext",function(){return t.hideNext()}),t.prototypeView.on("ready",function(){return t.prototypeRendered=!0}),t.prototypeView.setElement(t.$el.find("#prototype_wrapper")),t.prototypeView.render(),t.flagRender("subtest")}}(this),e=this.model.get("language"),e?i18n.setLng(e,function(){return function(e){return window.t=e,t()}}(this)):i18n.setLng(Tangerine.settings.get("language"),function(){return function(){return t()}}(this))},o.prototype.flagRender=function(t){return this.renderFlags||(this.renderFlags={}),this.renderFlags[t]=!0,this.renderFlags.subtest&&this.renderFlags.prototype?this.trigger("rendered"):void 0},o.prototype.afterRender=function(){var t;return null!=(t=this.prototypeView)&&"function"==typeof t.afterRender&&t.afterRender(),this.onShow()},o.prototype.showNext=function(){return this.$el.find(".controlls").show()},o.prototype.hideNext=function(){return this.$el.find(".controlls").hide()},o.prototype.onShow=function(){var t,e,o,n,r,i;if(t=this.model.getString("displayCode"),!_.isEmptyString(t))try{CoffeeScript.eval.apply(this,[t])}catch(o){e=o,r=/function (.{1,})\(/.exec(e.constructor.toString())[1],n=e.message,alert(r+"\n\n"+n),console.log("displayCode Error: "+JSON.stringify(e))}return null!=(i=this.prototypeView)&&"function"==typeof i.updateExecuteReady?i.updateExecuteReady(!0):void 0},o.prototype.getGridScore=function(){var t,e,o;return o=this.model.get("gridLinkId")||"",""!==o?(t=this.parent.model.subtests.get(this.model.get("gridLinkId")),e=this.parent.result.getGridScore(t.id)):void 0},o.prototype.gridWasAutostopped=function(){var t,e,o;return o=this.model.get("gridLinkId")||"",""!==o?(t=this.parent.model.subtests.get(this.model.get("gridLinkId")),e=this.parent.result.gridWasAutostopped(t.id)):void 0},o.prototype.onClose=function(){var t;return null!=(t=this.prototypeView)&&"function"==typeof t.close?t.close():void 0},o.prototype.isValid=function(){return this.prototypeRendered&&null!=this.prototypeView.isValid?this.prototypeView.isValid():!1},o.prototype.showErrors=function(){return this.prototypeView.showErrors()},o.prototype.getSum=function(){return null!=this.prototypeView.getSum?this.prototypeView.getSum():{correct:0,incorrect:0,missing:0,total:0}},o.prototype.abort=function(){return this.parent.abort()},o.prototype.getResult=function(){var t,e;return e=this.prototypeView.getResult(),this.model.has("hash")&&(t=this.model.get("hash")),{body:e,meta:{hash:t}}},o.prototype.getSkipped=function(){if(null!=this.prototypeView.getSkipped)return this.prototypeView.getSkipped();throw"Prototype skipping not implemented"},o.prototype.next=function(){return this.trigger("next")},o.prototype.back=function(){return this.trigger("back")},o.prototype.skip=function(){return this.parent.skip()},o}(Backbone.View);