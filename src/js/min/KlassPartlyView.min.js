var KlassPartlyView,extend=function(t,e){function r(){this.constructor=t}for(var s in e)hasProp.call(e,s)&&(t[s]=e[s]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},hasProp={}.hasOwnProperty;KlassPartlyView=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}return extend(r,e),r.prototype.className="KlassPartlyView",r.prototype.events={"click .next_part":"nextPart","click .prev_part":"prevPart","click .back":"back","click .student_subtest":"gotoStudentSubtest","keyup #current_part":"gotoAssessment","keyup #search_student_name":"filterStudents","focus #search_student_name":"scrollToName"},r.prototype.scrollToName=function(){return this.$el.find("#search_student_name").scrollTo()},r.prototype.filterStudents=function(){var t;return t=this.$el.find("#search_student_name").val(),this.search=t,this.updateGridPage()},r.prototype.gotoAssessment=function(){var t;return t=this.$el.find("#current_part").val(),""!==t?(this.currentPart=parseInt(t),this.updateGridPage()):void 0},r.prototype.update=function(){return this.render(),Tangerine.router.navigate("class/"+this.options.klass.id+"/"+this.currentPart)},r.prototype.back=function(){return Tangerine.router.navigate("class",!0)},r.prototype.gotoStudentSubtest=function(t){var e,r;return e=$(t.target).attr("data-studentId"),r=$(t.target).attr("data-subtestId"),Tangerine.router.navigate("class/result/student/subtest/"+e+"/"+r,!0)},r.prototype.nextPart=function(){return this.currentPart<this.lastPart?(this.currentPart++,this.update()):void 0},r.prototype.prevPart=function(){return this.currentPart>1?(this.currentPart--,this.update()):void 0},r.prototype.initialize=function(t){return this.search="",this.currentPart=t.part||1,this.subtestsByPart=[],this.subtestsByPart=t.subtests.indexBy("part"),this.lastPart=Math.max.apply(this,_.compact(t.subtests.pluck("part")))||1},r.prototype.updateGridPage=function(){return this.$el.find("#grid_container").html(this.getGridPage())},r.prototype.getGridPage=function(){var t,e,r,s,n,a,i,o,u,d,c,p,h,l,g,b,y,f,m,P,v,k,w,I,x,T,N,$,G,S,B;if(G=[],$=this.subtestsByPart[this.currentPart],null==$)return"No subtests for this assessment.";for(v=this.options.students.models,n=o=0,u=v.length;u>o;n=++o)for(x=v[n],G[n]=[],k=new KlassResults(this.options.results.where({studentId:x.id})),a=l=0,d=$.length;d>l;a=++l)if(N=$[a],T=k.where({subtestId:N.id}),S=0!==T.length,~x.get("name").toLowerCase().indexOf(this.search.toLowerCase())||""===this.search){for(i=g=6;g>=0;i=--g)f=this.currentPart-i,I=k.where({part:f,itemType:N.get("itemType")}),I.length&&(P=i);t=2>=P?"":4>=P?"rgb(229, 208, 149)":"rgb(222, 156, 117)",G[n].push({content:S?"&#x2714;":"?",taken:S,studentId:x.id,studentName:x.get("name"),subtestId:N.id,background:t})}for(s="<table class='info_box_wide'><tbody><tr><th></th>",b=0,c=$.length;c>b;b++)N=$[b],s+="<th><div class='part_subtest_report' data-id='"+N.id+"'>"+N.get("name")+"</div></th>";for(s+="</tr>",y=0,p=G.length;p>y;y++)if(w=G[y],null!=w&&w.length){for(s+="<tr><td><div class='student' data-studentId='"+w[0].studentId+"'>"+w[0].studentName+"</div></td>",r=m=0,h=w.length;h>m;r=++m)e=w[r],B=e.taken?" subtest_taken":"",s+="<td><div class='student_subtest command "+B+"' data-taken='"+e.taken+"' data-studentId='"+e.studentId+"' data-subtestId='"+e.subtestId+"' style='background-color:"+e.background+" !important;'>"+e.content+"</div></td>";s+="</tr>"}return s+="</tbody></table>",0===_.flatten(G).length&&(s="<p class='grey'>No students found.</p>"),s},r.prototype.render=function(){var e;return e=this.getGridPage(),this.$el.html("<h1>"+t("assessment status")+"</h1> <input id='search_student_name' style='width: 92% !important' placeholder='"+t("search student name")+"' type='text'> <div id='grid_container'>"+e+"</div><br> <h2>"+t("current assessment")+" </h2> <button class='prev_part command'>&lt;</button> <input type='number' value='"+this.currentPart+"' id='current_part'> <button class='next_part command'>&gt;</button><br><br> <button class='back navigation'>"+t("back")+"</button>"),this.trigger("rendered")},r}(Backbone.View);