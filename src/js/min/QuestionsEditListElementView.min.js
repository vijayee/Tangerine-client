var QuestionsEditListElementView,bind=function(t,e){return function(){return t.apply(e,arguments)}},extend=function(t,e){function i(){this.constructor=t}for(var n in e)hasProp.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},hasProp={}.hasOwnProperty;QuestionsEditListElementView=function(e){function i(){return this.copy=bind(this.copy,this),this.getSurveys=bind(this.getSurveys,this),i.__super__.constructor.apply(this,arguments)}return extend(i,e),i.prototype.className="question_list_element",i.prototype.tagName="li",i.prototype.events={"click .edit":"edit","click .show_copy":"showCopy","change .copy_select":"copy","click .delete":"toggleDelete","click .delete_cancel":"toggleDelete","click .delete_delete":"delete"},i.prototype.showCopy=function(){var t;return t=this.$el.find(".copy_container"),t.html("Copy to <select class='copy_select'><option disabled='disabled' selected='selected'>Loading...</option></select>"),this.getSurveys()},i.prototype.getSurveys=function(){var t;return t="server"===Tangerine.settings.get("context")?Tangerine.settings.urlView("group","subtestsByAssessmentId"):Tangerine.settings.urlView("local","subtestsByAssessmentId"),$.ajax({url:t,type:"POST",dataType:"json",contentType:"application/json",data:JSON.stringify({keys:[this.question.get("assessmentId")]}),success:function(t){return function(e){var i,n;return n=_.compact(function(){var t,n,s,o;for(s=e.rows,o=[],t=0,n=s.length;n>t;t++)i=s[t],o.push("survey"===i.value.prototype?i.value:void 0);return o}()),console.log(n),t.populateSurveySelect(n)}}(this)})},i.prototype.populateSurveySelect=function(t){var e,i;return t.push({_id:"cancel",name:this.text.cancel_button}),t.unshift({_id:"",name:this.text.select}),e=function(){var e,n,s;for(s=[],e=0,n=t.length;n>e;e++)i=t[e],s.push("<option data-subtestId='"+i._id+"' "+(i.attrs||"")+">"+i.name+"</option>");return s}().join(""),this.$el.find(".copy_select").html(e)},i.prototype.copy=function(t){var e,i,n;return e=$(t.target).find("option:selected"),n=e.attr("data-subtestId"),"cancel"===n?void this.$el.find(".copy_container").empty():(i=this.question.clone(),i.save({_id:Utils.guid(),subtestId:n},{success:function(t){return function(){return n===t.question.get("subtestId")?(Utils.midAlert("Question duplicated"),t.trigger("duplicate")):(Tangerine.router.navigate("subtest/"+n,!0),Utils.midAlert("Question copied to "+e.html()))}}(this),error:function(){return Utils.midAlert("Copy error")}}))},i.prototype.edit=function(){return this.trigger("question-edit",this.question.id),!1},i.prototype.toggleDelete=function(){return this.$el.find(".delete_confirm").fadeToggle(250)},i.prototype["delete"]=function(){return this.question.collection.remove(this.question.id),this.question.destroy(),this.trigger("deleted"),!1},i.prototype.initialize=function(e){return this.text={edit:t("QuestionsEditListElementView.help.edit"),"delete":t("QuestionsEditListElementView.help.delete"),copy:t("QuestionsEditListElementView.help.copy_to"),cancel_button:t("QuestionsEditListElementView.button.cancel"),delete_button:t("QuestionsEditListElementView.button.delete"),select:t("QuestionsEditListElementView.label.select"),loading:t("QuestionsEditListElementView.label.loading"),delete_confirm:t("QuestionsEditListElementView.label.delete_confirm")},this.question=e.question,this.$el.attr("data-id",this.question.id)},i.prototype.render=function(){return this.$el.html("<table> <tr> <td> <img src='images/icon_drag.png' width='36' height='36' class='sortable_handle'> </td> <td> <span>"+this.question.get("prompt")+"</span> <span>[<small>"+this.question.get("name")+", "+this.question.get("type")+"</small>]</span> <img src='images/icon_edit.png' width='36' height='36' class='link_icon edit' title='"+this.text.edit+"'> <img src='images/icon_copy_to.png' width='36' height='36' class='link_icon show_copy' title='"+this.text.copy+"'> <span class='copy_container'></span> <img src='images/icon_delete.png' width='36' height='36' class='link_icon delete' title='"+this.text["delete"]+"'><br> <div class='confirmation delete_confirm'> <div class='menu_box'>"+this.text.delete_confirm+"<br><button class='delete_delete command_red'>Delete</button><button class='delete_cancel command'>"+this.text.cancel_button+"</button> </div> </td> </tr> </table>"),this.trigger("rendered")},i}(Backbone.View);