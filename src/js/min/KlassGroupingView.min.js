var KlassGroupingView,extend=function(t,e){function s(){this.constructor=t}for(var r in e)hasProp.call(e,r)&&(t[r]=e[r]);return s.prototype=e.prototype,t.prototype=new s,t.__super__=e.prototype,t},hasProp={}.hasOwnProperty;KlassGroupingView=function(e){function s(){return s.__super__.constructor.apply(this,arguments)}return extend(s,e),s.prototype.className="KlassGroupingView",s.prototype.normalCurve=[0,.00399,.00798,.01197,.01595,.01994,.02392,.0279,.03188,.03586,.03983,.0438,.04776,.05172,.05567,.05962,.06356,.06749,.07142,.07535,.07926,.08317,.08706,.09095,.09483,.09871,.10257,.10642,.11026,.11409,.11791,.12172,.12552,.1293,.13307,.13683,.14058,.14431,.14803,.15173,.15542,.1591,.16276,.1664,.17003,.17364,.17724,.18082,.18439,.18793,.19146,.19497,.19847,.20194,.2054,.20884,.21226,.21566,.21904,.2224,.22575,.22907,.23237,.23565,.23891,.24215,.24537,.24857,.25175,.2549,.25804,.26115,.26424,.2673,.27035,.27337,.27637,.27935,.2823,.28524,.28814,.29103,.29389,.29673,.29955,.30234,.30511,.30785,.31057,.31327,.31594,.31859,.32121,.32381,.32639,.32894,.33147,.33398,.33646,.33891,.34134,.34375,.34614,.34849,.35083,.35314,.35543,.35769,.35993,.36214,.36433,.3665,.36864,.37076,.37286,.37493,.37698,.379,.381,.38298,.38493,.38686,.38877,.39065,.39251,.39435,.39617,.39796,.39973,.40147,.4032,.4049,.40658,.40824,.40988,.41149,.41308,.41466,.41621,.41774,.41924,.42073,.4222,.42364,.42507,.42647,.42785,.42922,.43056,.43189,.43319,.43448,.43574,.43699,.43822,.43943,.44062,.44179,.44295,.44408,.4452,.4463,.44738,.44845,.4495,.45053,.45154,.45254,.45352,.45449,.45543,.45637,.45728,.45818,.45907,.45994,.4608,.46164,.46246,.46327,.46407,.46485,.46562,.46638,.46712,.46784,.46856,.46926,.46995,.47062,.47128,.47193,.47257,.4732,.47381,.47441,.475,.47558,.47615,.4767,.47725,.47778,.47831,.47882,.47932,.47982,.4803,.48077,.48124,.48169,.48214,.48257,.483,.48341,.48382,.48422,.48461,.485,.48537,.48574,.4861,.48645,.48679,.48713,.48745,.48778,.48809,.4884,.4887,.48899,.48928,.48956,.48983,.4901,.49036,.49061,.49086,.49111,.49134,.49158,.4918,.49202,.49224,.49245,.49266,.49286,.49305,.49324,.49343,.49361,.49379,.49396,.49413,.4943,.49446,.49461,.49477,.49492,.49506,.4952,.49534,.49547,.4956,.49573,.49585,.49598,.49609,.49621,.49632,.49643,.49653,.49664,.49674,.49683,.49693,.49702,.49711,.4972,.49728,.49736,.49744,.49752,.4976,.49767,.49774,.49781,.49788,.49795,.49801,.49807,.49813,.49819,.49825,.49831,.49836,.49841,.49846,.49851,.49856,.49861,.49865,.49869,.49874,.49878,.49882,.49886,.49889,.49893,.49896,.499,.49903,.49906,.4991,.49913,.49916,.49918,.49921,.49924,.49926,.49929,.49931,.49934,.49936,.49938,.4994,.49942,.49944,.49946,.49948,.4995,.49952,.49953,.49955,.49957,.49958,.4996,.49961,.49962,.49964,.49965,.49966,.49968,.49969,.4997,.49971,.49972,.49973,.49974,.49975,.49976,.49977,.49978,.49978,.49979,.4998,.49981,.49981,.49982,.49983,.49983,.49984,.49985,.49985,.49986,.49986,.49987,.49987,.49988,.49988,.49989,.49989,.4999,.4999,.4999,.49991,.49991,.49992,.49992,.49992,.49992,.49993,.49993,.49993,.49994,.49994,.49994,.49994,.49995,.49995,.49995,.49995,.49995,.49996,.49996,.49996,.49996,.49996,.49996,.49997,.49997,.49997,.49997,.49997,.49997,.49997,.49997,.49998,.49998,.49998,.49998],s.prototype.colorClass=["concerning","poor","good","great"],s.prototype.status=["Concerning","Poor","Good","Great"],s.prototype.events={"click .back":"goBack","change #selector_container input":"selector","click .student_name":"showItemized"},s.prototype.showItemized=function(t){var e,s,r;return s=$(t.target),r=$(t.target).attr("data-studentId"),e=this.$el.find(".student_"+r),e.is(":visible")?(e.addClass("confirmation"),s.css({color:"black"})):(this.$el.find(".student_name").css({color:"black"}),s.css({color:"white"}),this.$el.find(".itemized_results").addClass("confirmation"),this.$el.find(".student_"+r).removeClass("confirmation"))},s.prototype.selector=function(){var t;return t=this.$el.find("#selector_container input:checked").attr("data-subtestId"),this.selected.subtestId=t,this.selected.results=this.results.where({subtestId:t}),this.updateTable(),this.render()},s.prototype.goBack=function(){return history.back()},s.prototype.initialize=function(t){var e,s,r,a,i;for(this.results=t.results,this.subtests=t.subtests,this.students=t.students,this.selected={},a=this.subtests.models,e=s=0,r=a.length;r>s&&(i=a[e],this.selected.subtestId=this.subtests.models[e].id,0===(this.selected.results=this.results.where({subtestId:i.id})).length);e=++s);return this.updateTable()},s.prototype.updateTable=function(){var t,e,s,r,a,i,o,n,h,c,d,l,u,m,p,g,b,y,f,C,v,w,I,k,_,M,x,z;for(this.table=[],t=0,this.subtest=this.subtests.get(this.selected.subtestId),this.summary={name:this.subtest.get("name"),classSize:this.students.length,resultCount:this.selected.results.length,aCorrect:0,anCorrect:0,stdDev:0,attempted:0,totalItems:null!=(w=this.selected.results[0])?w.get("total"):void 0,watchList:[]},I=this.selected.results,h=0,l=I.length;l>h;h++)x=I[h],v={studentId:x.get("studentId"),items:x.getItemized(),name:this.students.get(x.get("studentId")).get("name"),pCorrect:0,nCorrect:x.get("correct"),attempted:x.get("total")-x.get("missing"),total:x.get("total"),deviation:0,percentile:0,status:""},v.pCorrect=Math.round(v.nCorrect/v.attempted*100),this.summary.aCorrect+=v.pCorrect,this.summary.anCorrect+=v.nCorrect,this.summary.attempted+=v.attempted,this.table.push(v);for(this.summary.aCorrect=Math.decimals(this.summary.aCorrect/this.table.length,0),this.summary.anCorrect=Math.decimals(this.summary.anCorrect/this.table.length,2),this.summary.attempted=Math.decimals(this.summary.attempted/this.table.length,2),k=this.table,c=0,u=k.length;u>c;c++)v=k[c],this.summary.stdDev+=Math.pow(v.pCorrect-this.summary.aCorrect,2);for(this.summary.stdDev=Math.decimals(Math.pow(this.summary.stdDev/this.table.length,.5),2),_=this.table,i=d=0,m=_.length;m>d;i=++d)v=_[i],r=(v.pCorrect-this.summary.aCorrect)/this.summary.stdDev,a=Math.round(100*r),C=a>409||-409>a?0:a>0?100*Math.round(50+100*this.normalCurve[a])/100:0>a?100*Math.round(50-100*this.normalCurve[-1*a])/100:50,f=v.pCorrect,o=o=f>=80?3:f>=60&&79>=f?2:f>=30&&59>=f?1:0,this.table[i].deviation=a/100,this.table[i].percentile=C,this.table[i].index=o,this.table[i].status=this.status[o],0!==o||~this.summary.watchList.indexOf(v.name)||this.summary.watchList.push(v.name);for(this.table.sort(function(t,e){return e.pCorrect-t.pCorrect}),b=0,M=this.table,g=0,p=M.length;p>g;g++)v=M[g],v.pCorrect<75&&b++;return y=b/this.table.length*100,n=20>y,z="<img src='images/icon_warn.png'>",this.readyPercentage="<p>"+Math.round(y)+"% of your students are not ready to move on to the next lessons.</p>",s="It is ok to move on in the lesson sequence. Make sure that those children performing in the \u201cpoor\u201d or \u201cconcerning\u201d category get extra attention and practice and don\u2019t fall behind. This can be done during practice lessons on Tuesday and Thursdays, or during another subject on the timetable.",e="Your class needs extra practice. Consider re-teaching Monday and Wednesday lessons introducing the new curriculum items or organize intense practice activities for the entire class. To find out which items students are particularly struggling with, select the name of a few students in the \u201cpoor\u201d or \u201cconcerning\u201d category and review their performance item by item. Take note of items that seem particularly troublesome.",this.readinessWarning=n?s:e},s.prototype.render=function(){var e,s,r,a,i,o,n,h,c,d,l,u,m,p,g,b,y,f,C,v,w;for(~this.subtests.pluck("reportType").indexOf("progress")||(w="<section> "+this.readyPercentage+" "+this.readinessWarning+" </section>",w+="<section> <p>Refer to the file \u201cKiswahili Wordlists\u201d on your tablet for a list of additional words that may be useful for such group-based activities or practice for students performing in the \u201cpoor\u201d or \u201cconcerning\u201d category.</p> <p>For the students to watch \u2013 consider also communicating with parents for extra practice at home.</p> <p>Identify items these students need further practice on by selecting their name in the grouping report to see their performance on each item.</p> <p>Give parents some help: Write out on a piece of paper the letters for them to practice with their child; or copy applicable words from the \u201cKiswahili Wordlists\u201d that contain the letters for the child to practice.</p> </section>"),a="<h1>"+t("student grouping report")+"</h1> <p>No students tested for "+this.subtests.get(this.selected.subtestId).get("name")+" on assessment #"+this.subtests.models[0].get("part")+" yet. Return to the <a href='#class'>class menu</a> and click the <img src='images/icon_run.png'> icon to collect data.</p>",p="<div id='selector_container' class='buttonset'>",b=this.subtests.models,h=0,l=b.length;l>h;h++)C=b[h],e=C.id===this.selected.subtestId?"checked='checked'":"",p+="<label for='"+C.id+"'>"+C.get("name")+"</label> <input type='radio' class='selector' name='selector' id='"+C.id+"' data-subtestId='"+C.id+"' "+e+">";for(p+="</div>",v="<h1>Summary</h1> <table class='summary'> <tr><th>Subtest Name</th>          <td>"+this.summary.name+"</td></tr> <tr><th>Class Size</th>            <td>"+this.summary.classSize+"</td></tr> <tr><th>Students Assessed</th>     <td>"+this.summary.resultCount+"</td></tr> <tr><th>Average Correct (%)</th>   <td>"+this.summary.aCorrect+"%</td></tr> <tr><th>Average Correct</th>       <td>"+this.summary.anCorrect+" / "+this.summary.attempted+"</td></tr> <tr><th>Students to watch</th>     <td>"+this.summary.watchList.join(", ")+"</td></tr> </table>",r="<h1>Student grouping</h1> <table class='details'> <tr> <th>Name</th> <th>% correct</th> <th>Status</th> </tr>",n="",y=this.table,c=0,u=y.length;u>c;c++){for(g=y[c],r+="<tr class='"+this.colorClass[g.index]+"'> <td class='student_name icon' data-studentId='"+g.studentId+"'>"+g.name+"</td> <td>"+g.pCorrect+"</td> <td>"+g.status+"</td> </tr>",n+="<table class='itemized_results confirmation student_"+g.studentId+"'> <tbody><tr><th>Item</th><th>Result</th></tr>",f=g.items,o=d=0,m=f.length;m>d;o=++d)s=f[o],n+="<tr><td>"+s.itemLabel+"</td><td>"+t(s.itemResult)+"</td></tr>";n+="</tbody></table>"}return r+="</table>",i=0!==this.selected.results.length?p+" "+v+" "+r+" "+n+" "+(w||"")+" <button class='navigation back'>Back</button>":p+" "+a+" <button class='navigation back'>Back</button>",this.$el.html(i),this.trigger("rendered")},s.prototype.getQuartile=function(t){return Math.round(t/100*3)},s}(Backbone.View);